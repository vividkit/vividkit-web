---
import { commandCategories } from '@/data/commands';
import { useTranslations } from '@/i18n/utils';
import { getLangFromUrl, type Language } from '@/i18n';

interface Props {
  class?: string;
  lang?: Language;
}

const { class: className = '', lang } = Astro.props;

// Get language from URL if not provided
const currentLang = lang || getLangFromUrl(Astro.url);
const t = useTranslations(currentLang);

const categoryStyles = {
  'Beginner': {
    border: 'border-green-500/30 hover:border-green-500/50',
    headerBg: 'bg-gradient-to-br from-green-500/10 to-emerald-500/10',
    iconBg: 'bg-green-500/20',
    iconColor: 'text-green-500 dark:text-green-400',
    titleColor: 'text-green-600 dark:text-green-400',
    codeColor: 'text-green-600 dark:text-green-400',
    hoverBorder: 'hover:border-green-500/40'
  },
  'Intermediate': {
    border: 'border-amber-500/30 hover:border-amber-500/50',
    headerBg: 'bg-gradient-to-br from-amber-500/10 to-orange-500/10',
    iconBg: 'bg-amber-500/20',
    iconColor: 'text-amber-500 dark:text-amber-400',
    titleColor: 'text-amber-600 dark:text-amber-400',
    codeColor: 'text-amber-600 dark:text-amber-400',
    hoverBorder: 'hover:border-amber-500/40'
  },
  'Advanced': {
    border: 'border-red-500/30 hover:border-red-500/50',
    headerBg: 'bg-gradient-to-br from-red-500/10 to-pink-500/10',
    iconBg: 'bg-red-500/20',
    iconColor: 'text-red-500 dark:text-red-400',
    titleColor: 'text-red-600 dark:text-red-400',
    codeColor: 'text-red-600 dark:text-red-400',
    hoverBorder: 'hover:border-red-500/40'
  }
};

const getStyle = (title: string) => {
  if (title.includes('Beginner') || title.includes('New')) return categoryStyles['Beginner'];
  if (title.includes('Intermediate') || title.includes('Experienced')) return categoryStyles['Intermediate'];
  if (title.includes('Advanced') || title.includes('Pro')) return categoryStyles['Advanced'];
  return categoryStyles['Beginner'];
};

// Translated categories
const translatedCategories = commandCategories.map(category => {
  let translatedTitle = category.title;
  let translatedDescription = category.description;
  let translatedCommands = category.commands;

  if (category.title === 'Beginner') {
    translatedTitle = t('commands.category_beginner');
    translatedDescription = t('commands.desc.beginner');
    translatedCommands = category.commands.map(cmd => {
      if (cmd.name.includes('/ask')) return { ...cmd, description: t('commands.ask.desc') };
      if (cmd.name.includes('/brainstorm')) return { ...cmd, description: t('commands.brainstorm.desc') };
      if (cmd.name.includes('/fix')) return { ...cmd, description: t('commands.fix.desc') };
      return cmd;
    });
  }

  if (category.title === 'Intermediate') {
    translatedTitle = t('commands.category_intermediate');
    translatedDescription = t('commands.desc.intermediate');
    translatedCommands = category.commands.map(cmd => {
      if (cmd.name.includes('/plan')) return { ...cmd, description: t('commands.plan.desc') };
      if (cmd.name.includes('/code')) return { ...cmd, description: t('commands.code.desc') };
      if (cmd.name.includes('/cook')) return { ...cmd, description: t('commands.cook.desc') };
      return cmd;
    });
  }

  if (category.title === 'Advanced') {
    translatedTitle = t('commands.category_advanced');
    translatedDescription = t('commands.desc.advanced');
    translatedCommands = category.commands.map(cmd => {
      if (cmd.name.includes('/bootstrap')) return { ...cmd, description: t('commands.bootstrap.desc') };
      if (cmd.name.includes('/scout')) return { ...cmd, description: t('commands.scout.desc') };
      if (cmd.name.includes('/watzup')) return { ...cmd, description: t('commands.watzup.desc') };
      return cmd;
    });
  }

  return {
    ...category,
    title: translatedTitle,
    description: translatedDescription,
    commands: translatedCommands,
    originalTitle: category.title
  };
});
---

<section id="commands" class={`section py-24 relative ${className}`}>
  <div class="max-w-6xl mx-auto px-6">
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl font-heading font-bold mb-6">
        {t('commands.title')}
        <span class="block bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
          {t('commands.subtitle')}
        </span>
      </h2>
      <p class="text-xl text-slate-600 dark:text-slate-400 mb-4">
        {t('commands.description')}
      </p>
      <div class="max-w-3xl mx-auto space-y-3">
        <p class="text-lg font-semibold text-slate-700 dark:text-slate-300">
          <strong>{t('commands.in_vividkit')}</strong> {t('commands.in_vividkit_description')}
        </p>
        <p class="text-sm italic text-slate-500 dark:text-slate-500 mt-4">
          {t('commands.terminal_reference')}
        </p>
      </div>
    </div>

    <!-- Quick Start Cards -->
    <div class="grid md:grid-cols-3 gap-6 mb-12">
      {translatedCategories.map((category) => {
        const style = getStyle(category.originalTitle);
        return (
          <div class={`feature-card glass-card rounded-2xl overflow-hidden border ${style.border} cursor-pointer`}>
            <div class={`p-6 ${style.headerBg} border-b border-slate-200 dark:border-slate-700/50`}>
              <div class="flex items-center gap-3 mb-2">
                <div class={`w-10 h-10 rounded-xl ${style.iconBg} flex items-center justify-center`}>
                  {category.originalTitle.includes('Beginner') && (
                    <svg class={`w-5 h-5 ${style.iconColor}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                  )}
                  {category.originalTitle.includes('Intermediate') && (
                    <svg class={`w-5 h-5 ${style.iconColor}`} viewBox="0 0 24 24" fill="currentColor">
                      <path d="M13 3L4 14h7l-1 7 9-11h-7l1-7z"></path>
                    </svg>
                  )}
                  {category.originalTitle.includes('Advanced') && (
                    <svg class={`w-5 h-5 ${style.iconColor}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                    </svg>
                  )}
                </div>
                <div>
                  <h3 class={`font-heading text-lg font-bold ${style.titleColor}`}>
                    {category.title}
                  </h3>
                  <p class="text-xs text-slate-500">{category.description}</p>
                </div>
              </div>
            </div>
            <div class="p-4 space-y-2">
              {category.commands.map((command) => (
                <div class={`p-3 rounded-lg bg-slate-100 dark:bg-surface-950 border border-slate-200 dark:border-slate-800 ${style.hoverBorder} transition-colors cursor-pointer`}>
                  <code class={`text-sm ${style.codeColor} font-mono block truncate`}>{command.name}</code>
                  <p class="text-xs text-slate-500 mt-1">{command.description}</p>
                </div>
              ))}
            </div>
          </div>
        );
      })}
    </div>

    <!-- Pro Tips -->
    <div class="glass-card rounded-2xl p-8 border border-slate-200 dark:border-slate-800">
      <div class="flex items-center gap-4 mb-6">
        <div class="flex-shrink-0 p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl text-blue-600 dark:text-blue-400">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
        </div>
        <h3 class="text-lg font-semibold">{t('commands.pro_tips')}</h3>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-500 dark:text-blue-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div>
            <div class="text-sm font-medium text-slate-900 dark:text-slate-200 mb-1">{t('commands.tip1.title')}</div>
            <div class="text-xs text-slate-600 dark:text-slate-400" set:html={t('commands.tip1.description').replace('/clear', '<code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-mono">/clear</code>')}></div>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-purple-500 dark:text-purple-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div>
            <div class="text-sm font-medium text-slate-900 dark:text-slate-200 mb-1">{t('commands.tip2.title')}</div>
            <div class="text-xs text-slate-600 dark:text-slate-400" set:html={t('commands.tip2.description').replace('@plan.md', '<code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-mono">@plan.md</code>')}></div>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-green-500 dark:text-green-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div>
            <div class="text-sm font-medium text-slate-900 dark:text-slate-200 mb-1">{t('commands.tip3.title')}</div>
            <div class="text-xs text-slate-600 dark:text-slate-400" set:html={t('commands.tip3.description').replace('/git:cm', '<code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-mono">/git:cm</code>')}></div>
          </div>
        </div>
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-amber-500 dark:text-amber-400 mt-0.5 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
          <div>
            <div class="text-sm font-medium text-slate-900 dark:text-slate-200 mb-1">{t('commands.tip4.title')}</div>
            <div class="text-xs text-slate-600 dark:text-slate-400" set:html={t('commands.tip4.description').replace('/ask', '<code class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 font-mono">/ask</code>')}></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Learn More -->
    <div class="text-center mt-12">
      <h3 class="text-2xl font-heading font-bold text-slate-800 dark:text-slate-200 mb-6">{t('commands.learn_more')}</h3>
      <a href="/guides" class="inline-flex items-center gap-3 px-8 py-4 rounded-2xl glass-card hover:border-blue-500/50 font-semibold text-lg transition-all cursor-pointer">
        <svg class="w-6 h-6 text-blue-500 dark:text-blue-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
        </svg>
        <span>
          <div class="text-left">
            <div class="font-bold">{t('commands.getting_started')}</div>
            <div class="text-xs text-slate-500">{t('commands.getting_started_description')}</div>
          </div>
        </span>
      </a>
    </div>
  </div>
</section>